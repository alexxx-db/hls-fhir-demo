resources:
  jobs:
    workshop_run_synthea_on_dbx:
      name: Run Synthea On DBX
      tasks:
        - task_key: Synthea_Deployment_Check
          notebook_task:
            notebook_path: ${workspace.root_path}/src/FHIR_Workshop/setup/Check For Synthea Job Deployment.ipynb
            source: WORKSPACE
        - task_key: Synthea_Deployed_Conditional
          depends_on:
            - task_key: Synthea_Deployment_Check
          condition_task:
            op: EQUAL_TO
            left: "{{tasks.Synthea_Deployment_Check.values.job_exists}}"
            right: "true"
        - task_key: Deploy_Synthea_On_DBX_Workflow
          depends_on:
            - task_key: Synthea_Deployed_Conditional
              outcome: "false"
          notebook_task:
            notebook_path: synthea-on-databricks
            base_parameters:
              catalog_name: "{{job.parameters.catalog_use}}"
              schema_name: "{{job.parameters.schema_use}}"
              max_records: "1600"
              min_records: "1500"
              number_of_job_runs: "1"
              create_landing_zone: "true"
              instance_pool_id: ""
              inject_bad_data: "true"
              serverless: "false"
              run_job: "false"
            source: GIT
      git_source:
        git_url: https://github.com/matthew-gigl-db/synthea-on-dbx.git
        git_provider: gitHub
        git_branch: main
      queue:
        enabled: true
      parameters:
        - name: catalog_use
          default: ${var.catalog_use}
        - name: schema_use
          default: ${var.schema_use}
